apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-pdf-config
  labels:
    app: pdf-mcp-server
data:
  nginx.conf: |
    pid /tmp/nginx.pid;
    error_log /dev/stderr;
    
    events {
        worker_connections 1024;
    }
    
    http {
        include /etc/nginx/mime.types;
        default_type application/octet-stream;
        
        access_log /dev/stdout;
        
        client_body_temp_path /tmp/client_temp;
        proxy_temp_path       /tmp/proxy_temp_path;
        fastcgi_temp_path     /tmp/fastcgi_temp;
        uwsgi_temp_path       /tmp/uwsgi_temp;
        scgi_temp_path        /tmp/scgi_temp;
        
        server {
            listen 8080;
            server_name _;
            
            location /files/ {
                alias /usr/share/nginx/html/files/;
                autoindex on;
                autoindex_exact_size off;
                autoindex_localtime on;
                
                # Allow CORS
                add_header Access-Control-Allow-Origin *;
                add_header Access-Control-Allow-Methods "GET, OPTIONS";
                add_header Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range";
                
                # Handle OPTIONS requests
                if ($request_method = 'OPTIONS') {
                    add_header Access-Control-Allow-Origin *;
                    add_header Access-Control-Max-Age 1728000;
                    add_header Content-Type 'text/plain charset=UTF-8';
                    add_header Content-Length 0;
                    return 204;
                }
            }
            
            # Health check endpoint
            location /health {
                return 200 "healthy\n";
                add_header Content-Type text/plain;
            }
        }
    }